<div class="card">
  <div class="card-body login-card-body">
    <p class="login-box-msg">Sign in to start your session</p>
    
    <!-- แก้ไข error messages - เช็คให้ปลอดภัยขึ้น -->
    <% if (typeof error !== 'undefined' && error && String(error).trim() !== '') { %>
      <div class="alert alert-danger alert-dismissible">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <i class="icon fas fa-ban"></i> <%= error %>
      </div>
    <% } %>
    
    <!-- แก้ไข success messages - เช็คให้ปลอดภัยขึ้น -->
    <% if (typeof success !== 'undefined' && success && String(success).trim() !== '') { %>
      <div class="alert alert-success alert-dismissible">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <i class="icon fas fa-check"></i> <%= success %>
      </div>
    <% } %>
      
    <form action="/login" method="post" id="loginForm">
      <!-- ตรวจสอบ CSRF token -->
      <% if (typeof csrfToken !== 'undefined') { %>
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <% } else { %>
        <div class="alert alert-warning">CSRF Token not found - Login may fail</div>
      <% } %>
      <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Username" name="username" required>
        <div class="input-group-append">
          <div class="input-group-text">
            <span class="fas fa-user"></span>
          </div>
        </div>
      </div>
      <div class="input-group mb-3">
        <input type="password" class="form-control" placeholder="Password" name="password" required>
        <div class="input-group-append">
          <div class="input-group-text">
            <span class="fas fa-lock"></span>
          </div>
        </div>
      </div>
      <div class="row">      
          <button type="submit" class="btn btn-primary btn-block" id="loginBtn">
            <span class="spinner-border spinner-border-sm d-none" role="status"></span>
            Sign In
          </button>
        <!-- /.col -->
      </div>
    </form>
  </div>
  <!-- /.login-card-body -->
</div>

<script>
// เพิ่ม form submission feedback
document.getElementById('loginForm').addEventListener('submit', function() {
  const btn = document.getElementById('loginBtn');
  const spinner = btn.querySelector('.spinner-border');
  btn.disabled = true;
  spinner.classList.remove('d-none');
});
</script>
  